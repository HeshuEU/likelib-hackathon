syntax = "proto3";

// Cross platform definitions
option java_multiple_files = true;
option java_package = "by.heshu.likelib.rpc";
option java_outer_classname = "LikelibNodeProto";
option objc_class_prefix = "LKL";

// Service and messages definitions
package likelib;

service NodePublicInterface {
    rpc test (TestRequest) returns (TestResponse) {
    }

    rpc balance (Address) returns (Money) {
    }

    rpc message_call (TransactionMessageCallRequest) returns (TransactionMessageCallResponse) {
    }

    rpc create_contract (TransactionCreateContractRequest) returns (TransactionCreateContractResponse) {
    }
}

//=====================================

message TestRequest {
    uint32 interface_version = 1;
}

message TestResponse {
    OperationStatus status = 1;
}

//=====================================

message TransactionMessageCallRequest {
    uint64 nonce = 1;
    Address from = 2;
    Address to = 3;
    Money value = 4;
    Money gas = 5;
    Time creation_time = 6;
    string data = 7;
    string signature = 8;
}

message TransactionMessageCallResponse {
    OperationStatus status = 1;
    Money gas_left = 2;
    string contract_response = 3;
}

//=====================================

message TransactionCreateContractRequest {
    uint64 nonce = 1;
    Address from = 2;
    Money value = 3;
    Money gas = 4;
    Time creation_time = 5;
    string contract_code = 6;
    string init = 7;
    string signature = 8;
}

message TransactionCreateContractResponse {
    OperationStatus status = 1;
    Money gas_left = 2;
    Address contract_address = 3;
}

//=====================================

message Contract {
    string bytecode = 1;
}

message Time {
    uint64 since_epoch = 1;
}

message Money {
    uint64 money = 1;
}

message Address {
    string address = 1;
}

message Signature {
    string raw = 1;
}

message OperationStatus {
    enum StatusCode {
        Success = 0;
        Rejected = 1;
        Failed = 2;
    }
    StatusCode status = 1;
    string message = 2;
}
